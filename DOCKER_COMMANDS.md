# üê≥ **DOCKER COMMANDS - CHEAT SHEET**

## ‚ö° **QUICK START - 3 L·ªÜNH**

```bash
cd CONGNGHEPHANMEM
copy .env.example .env
docker-compose up --build -d
```

**‚úÖ XONG! Truy c·∫≠p: http://localhost:3000/api/health**

---

## üöÄ **KH·ªûI ƒê·ªòNG**

```bash
# Ch·∫°y t·∫•t c·∫£ services ·ªü ch·∫ø ƒë·ªô n·ªÅn (detached mode)
# S·ª≠ d·ª•ng h√†ng ng√†y ƒë·ªÉ kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
docker-compose up -d

# Build l·∫°i images v√† ch·∫°y (khi c√≥ thay ƒë·ªïi code ho·∫∑c Dockerfile)
# S·ª≠ d·ª•ng khi: th√™m package m·ªõi, s·ª≠a Dockerfile, ho·∫∑c l·∫ßn ƒë·∫ßu ch·∫°y
docker-compose up --build -d

# Ch·∫°y v√† xem logs tr·ª±c ti·∫øp (kh√¥ng ch·∫°y n·ªÅn)
# H·ªØu √≠ch khi debug ho·∫∑c theo d√µi logs realtime
docker-compose up

# Ch·∫°y ch·ªâ m·ªôt service c·ª• th·ªÉ (v√≠ d·ª•: ch·ªâ database)
# H·ªØu √≠ch khi ch·ªâ c·∫ßn test database ho·∫∑c ch·∫°y t·ª´ng ph·∫ßn
docker-compose up mongodb -d    # Ch·ªâ ch·∫°y MongoDB
docker-compose up backend -d    # Ch·ªâ ch·∫°y Backend API
```

---

## ‚èπÔ∏è **D·ª™NG**

```bash
# D·ª´ng t·∫•t c·∫£ containers (gi·ªØ nguy√™n containers ƒë·ªÉ restart nhanh)
docker-compose stop

# D·ª´ng v√† x√≥a containers (th∆∞·ªùng d√πng nh·∫•t - an to√†n, gi·ªØ data)
# ‚ö†Ô∏è L∆∞u √Ω: L·ªánh n√†y ch·ªâ x√≥a containers, KH√îNG x√≥a data trong database
docker-compose down

# D·ª´ng, x√≥a containers + volumes (‚ö†Ô∏è NGUY HI·ªÇM - X√ìA T·∫§T C·∫¢ DATA)
# S·ª≠ d·ª•ng khi mu·ªën reset ho√†n to√†n database v√† b·∫Øt ƒë·∫ßu l·∫°i t·ª´ ƒë·∫ßu
docker-compose down -v

# D·ª´ng, x√≥a containers + images (ti·∫øt ki·ªám dung l∆∞·ª£ng ·ªï c·ª©ng)
# S·ª≠ d·ª•ng khi mu·ªën d·ªçn d·∫πp ho√†n to√†n ƒë·ªÉ build l·∫°i t·ª´ ƒë·∫ßu
docker-compose down --rmi all

# D·ª´ng m·ªôt service c·ª• th·ªÉ (v√≠ d·ª•: ch·ªâ d·ª´ng backend, gi·ªØ database ch·∫°y)
docker-compose stop backend
```

---

## üîÑ **RESTART**

```bash
# Restart t·∫•t c·∫£ services (nhanh nh·∫•t, gi·ªØ nguy√™n c·∫•u h√¨nh)
# S·ª≠ d·ª•ng khi: server b·ªã lag, c·∫ßn refresh to√†n b·ªô h·ªá th·ªëng
docker-compose restart

# Restart m·ªôt service c·ª• th·ªÉ (ch·ªâ restart ph·∫ßn c·∫ßn thi·∫øt)
# S·ª≠ d·ª•ng khi: ch·ªâ backend c√≥ v·∫•n ƒë·ªÅ, database v·∫´n ·ªïn
docker-compose restart backend    # Restart API server
docker-compose restart mongodb    # Restart database

# Restart v·ªõi rebuild (ch·∫≠m h∆°n nh∆∞ng ƒë·∫£m b·∫£o c·∫≠p nh·∫≠t code m·ªõi)
# S·ª≠ d·ª•ng khi: c√≥ thay ƒë·ªïi code quan tr·ªçng c·∫ßn build l·∫°i
docker-compose down               # D·ª´ng v√† x√≥a containers
docker-compose up --build -d     # Build l·∫°i v√† ch·∫°y
```

---

## üîç **KI·ªÇM TRA TR·∫†NG TH√ÅI**

```bash
# Xem tr·∫°ng th√°i containers
docker-compose ps

# Xem t·∫•t c·∫£ containers (c·∫£ stopped)
docker ps -a

# Xem resource usage (CPU, Memory)
docker stats

# Xem disk usage
docker system df

# Xem networks
docker network ls

# Xem volumes
docker volume ls
```

---

## üìù **XEM LOGS**

```bash
# Xem logs c·ªßa t·∫•t c·∫£ services (m·ªôt l·∫ßn, kh√¥ng theo d√µi ti·∫øp)
# H·ªØu √≠ch ƒë·ªÉ xem t·ªïng quan l·ªói c·ªßa to√†n b·ªô h·ªá th·ªëng
docker-compose logs

# Xem logs realtime (theo d√µi li√™n t·ª•c - follow mode)
# S·ª≠ d·ª•ng khi: debug l·ªói, theo d√µi request, monitor h·ªá th·ªëng
docker-compose logs -f

# Xem logs c·ªßa m·ªôt service c·ª• th·ªÉ (t·∫≠p trung v√†o m·ªôt ph·∫ßn)
docker-compose logs backend     # Logs c·ªßa API server
docker-compose logs mongodb     # Logs c·ªßa database
docker-compose logs redis       # Logs c·ªßa cache server

# Xem logs v·ªõi gi·ªõi h·∫°n s·ªë d√≤ng (tr√°nh qu√° nhi·ªÅu th√¥ng tin)
docker-compose logs --tail=50 backend      # 50 d√≤ng cu·ªëi
docker-compose logs --tail=100 -f backend  # 100 d√≤ng cu·ªëi + theo d√µi ti·∫øp

# Xem logs t·ª´ th·ªùi gian c·ª• th·ªÉ (l·ªçc theo th·ªùi gian)
docker-compose logs --since=10m backend                    # 10 ph√∫t g·∫ßn ƒë√¢y
docker-compose logs --since="2025-07-24T10:00:00" backend  # T·ª´ th·ªùi ƒëi·ªÉm c·ª• th·ªÉ
```

---

## üîç **HEALTH CHECK & TEST**

```bash
# Test API health
curl http://localhost:3000/api/health

# Test t·ª´ trong container
docker-compose exec backend curl http://localhost:3000/api/health

# Test API endpoints
curl http://localhost:3000/api/products
curl http://localhost:3000/api/banners

# Ch·∫°y health check script
docker-compose exec backend node scripts/docker-health-check.js

# Ch·∫°y integration tests
docker-compose exec backend node scripts/test-docker-setup.js
```

---

## üñ•Ô∏è **TRUY C·∫¨P CONTAINERS**

```bash
# Truy c·∫≠p backend container
docker-compose exec backend bash
docker-compose exec backend sh

# Truy c·∫≠p MongoDB shell
docker-compose exec mongodb mongosh

# Truy c·∫≠p Redis CLI
docker-compose exec redis redis-cli

# Ch·∫°y l·ªánh trong container
docker-compose exec backend npm --version
docker-compose exec backend node --version
docker-compose exec backend ls -la
```

---

## üíæ **DATABASE OPERATIONS**

### **Backup Database**
```bash
# T·∫°o backup
docker exec nafood-mongodb mongodump \
  --uri="mongodb://admin:password123@localhost:27017/nafood?authSource=admin" \
  --out="/tmp/backup"

# Copy backup ra ngo√†i
docker cp nafood-mongodb:/tmp/backup ./backup

# Backup v·ªõi timestamp
BACKUP_NAME="nafood_backup_$(date +%Y%m%d_%H%M%S)"
docker exec nafood-mongodb mongodump \
  --uri="mongodb://admin:password123@localhost:27017/nafood?authSource=admin" \
  --out="/tmp/$BACKUP_NAME"
docker cp nafood-mongodb:/tmp/$BACKUP_NAME ./backups/
```

### **Restore Database**
```bash
# Copy backup v√†o container
docker cp ./backup nafood-mongodb:/tmp/backup

# Restore database
docker exec nafood-mongodb mongorestore \
  --uri="mongodb://admin:password123@localhost:27017/nafood?authSource=admin" \
  --drop /tmp/backup/nafood
```

### **Seed Data**
```bash
# Ch·∫°y seed script
docker-compose exec backend node scripts/seed-data.js

# Ho·∫∑c n·∫øu c√≥ npm script
docker-compose exec backend npm run seed
```

### **MongoDB Operations**
```bash
# Truy c·∫≠p MongoDB shell
docker-compose exec mongodb mongosh

# Trong MongoDB shell:
use nafood
db.products.find().limit(5)
db.users.countDocuments()
db.orders.find({status: "pending"})

# Ch·∫°y MongoDB command t·ª´ ngo√†i
docker-compose exec mongodb mongosh --eval "db.adminCommand('ping')"
```

---

## üõ†Ô∏è **DEVELOPMENT**

```bash
# C√†i package m·ªõi
docker-compose exec backend npm install package-name
docker-compose restart backend

# Ch·∫°y npm scripts
docker-compose exec backend npm run build
docker-compose exec backend npm test

# Copy file v√†o container
docker cp ./local-file.js nafood-backend:/app/

# Copy file t·ª´ container ra
docker cp nafood-backend:/app/logs/app.log ./logs/

# Xem c·∫•u tr√∫c th∆∞ m·ª•c trong container
docker-compose exec backend ls -la
docker-compose exec backend find . -name "*.js" | head -10
```

---

## üõ†Ô∏è **X·ª¨ L√ù L·ªñI**

### **Port Conflicts**
```bash
# Ki·ªÉm tra port ƒëang s·ª≠ d·ª•ng
netstat -ano | findstr :3000    # Windows
lsof -i :3000                   # Linux/macOS

# Thay ƒë·ªïi port trong docker-compose.yml
# ports:
#   - "3001:3000"  # D√πng port 3001 thay v√¨ 3000
```

### **Container Issues**
```bash
# Xem l·ªói chi ti·∫øt
docker-compose logs backend

# Restart container c√≥ v·∫•n ƒë·ªÅ
docker-compose restart backend

# Rebuild container
docker-compose up --build backend -d

# X√≥a v√† t·∫°o l·∫°i container
docker-compose rm backend
docker-compose up backend -d
```

### **Database Issues**
```bash
# Ki·ªÉm tra MongoDB logs
docker-compose logs mongodb

# Restart MongoDB
docker-compose restart mongodb

# Test MongoDB connection
docker-compose exec mongodb mongosh --eval "db.adminCommand('ping')"

# Reset MongoDB data (‚ö†Ô∏è X√ìA T·∫§T C·∫¢ DATA)
docker-compose down -v
docker volume rm congnghephanmem_mongodb_data
docker-compose up -d
```

### **Reset Everything**
```bash
# Soft reset (gi·ªØ data)
docker-compose down
docker-compose up --build -d

# Hard reset (x√≥a t·∫•t c·∫£)
docker-compose down -v --rmi all
docker system prune -a
docker-compose up --build -d
```

---

## üöÄ **PRODUCTION**

### **Deploy Production**
```bash
# T·∫°o production environment
cp .env.example .env.production

# Deploy v·ªõi production config
docker-compose --env-file .env.production up -d

# Ho·∫∑c s·ª≠ d·ª•ng production compose file
docker-compose -f docker-compose.prod.yml up -d
```

### **Security Commands**
```bash
# T·∫°o strong passwords
openssl rand -base64 32

# Update environment variables
# S·ª≠a .env file v·ªõi passwords m·ªõi
# MONGODB_URI=mongodb://admin:NEW_PASSWORD@mongodb:27017/nafood?authSource=admin
# JWT_SECRET=your-super-strong-32-char-secret
# SESSION_SECRET=your-super-strong-32-char-secret
```

### **Monitoring Production**
```bash
# Xem resource usage
docker stats --no-stream

# Xem logs production
docker-compose logs --since=1h -f

# Health check
curl -f http://localhost:3000/api/health || echo "Health check failed"
```

---

## üÜò **EMERGENCY COMMANDS**

### **When Everything Breaks**
```bash
# 1. Stop everything
docker-compose down -v

# 2. Clean Docker system
docker system prune -a -f

# 3. Remove all volumes
docker volume prune -f

# 4. Start fresh
docker-compose up --build -d
```

### **Nuclear Option (‚ö†Ô∏è DANGER)**
```bash
# Stop all containers
docker stop $(docker ps -aq)

# Remove all containers
docker rm $(docker ps -aq)

# Remove all images
docker rmi $(docker images -q) -f

# Remove all volumes
docker volume rm $(docker volume ls -q) -f

# Remove all networks
docker network rm $(docker network ls -q)
```

---

## üìä **MONITORING & DEBUGGING**

```bash
# Container details
docker inspect nafood-backend
docker inspect nafood-mongodb

# Network details
docker network inspect congnghephanmem_nafood-network

# Volume details
docker volume inspect congnghephanmem_mongodb_data

# Process list in containers
docker-compose top

# Container resource limits
docker stats --no-stream --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}"

# Disk usage by containers
docker system df -v
```

---

## üì± **QUICK REFERENCE**

| **M·ª•c ƒë√≠ch** | **L·ªánh** |
|--------------|----------|
| **Ch·∫°y** | `docker-compose up -d` |
| **D·ª´ng** | `docker-compose down` |
| **Restart** | `docker-compose restart` |
| **Build** | `docker-compose up --build -d` |
| **Logs** | `docker-compose logs -f` |
| **Status** | `docker-compose ps` |
| **Health** | `curl http://localhost:3000/api/health` |
| **Reset** | `docker-compose down -v && docker-compose up --build -d` |
| **Backup** | `docker exec nafood-mongodb mongodump --uri="..." --out="/tmp/backup"` |
| **Shell** | `docker-compose exec backend bash` |

---

## üéØ **WORKFLOW H√ÄNG NG√ÄY**

### **üåÖ B·∫Øt ƒë·∫ßu ng√†y**
```bash
cd CONGNGHEPHANMEM
docker-compose up -d
docker-compose logs -f backend
```

### **üíª Khi code thay ƒë·ªïi**
```bash
docker-compose restart backend
# Ho·∫∑c rebuild n·∫øu c·∫ßn:
docker-compose up --build backend -d
```

### **üîç Debug issues**
```bash
docker-compose logs backend
docker-compose exec backend bash
curl http://localhost:3000/api/health
```

### **üåô K·∫øt th√∫c ng√†y**
```bash
docker-compose stop
# Ho·∫∑c ƒë·ªÉ ch·∫°y ti·∫øp: kh√¥ng c·∫ßn l√†m g√¨
```

---

## üîó **IMPORTANT URLS**

- **üè† API Base**: http://localhost:3000/api
- **üîç Health Check**: http://localhost:3000/api/health
- **üì¶ Products**: http://localhost:3000/api/products
- **üé® Banners**: http://localhost:3000/api/banners
- **üë§ Auth Login**: http://localhost:3000/api/auth/login
- **üìù Auth Register**: http://localhost:3000/api/auth/register

---

## üéâ **SUCCESS INDICATORS**

### **‚úÖ Healthy Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-01-24T...",
  "mongodb": "connected"
}
```

### **‚úÖ Container Status:**
```
NAME                STATE               PORTS
nafood-backend      Up (healthy)        0.0.0.0:3000->3000/tcp
nafood-mongodb      Up (healthy)        0.0.0.0:27017->27017/tcp
nafood-redis        Up                  0.0.0.0:6379->6379/tcp
```

---

**üöÄ Docker Commands Ready! Bookmark this page for quick reference!**

**üí° M·∫πo hay: S·ª≠ d·ª•ng `Ctrl+F` ƒë·ªÉ t√¨m nhanh l·ªánh b·∫°n c·∫ßn!**

---

## üéØ **L·ªÜNH TH∆Ø·ªúNG D√ôNG NH·∫§T**

```bash
# Kh·ªüi ƒë·ªông h·ªá th·ªëng (h√†ng ng√†y)
docker-compose up -d

# D·ª´ng h·ªá th·ªëng (an to√†n, gi·ªØ data)
docker-compose down

# Restart khi c√≥ v·∫•n ƒë·ªÅ
docker-compose restart

# Build l·∫°i khi c√≥ code m·ªõi
docker-compose up --build -d

# Xem logs khi debug
docker-compose logs -f backend
```

**üìù Ghi nh·ªõ: `docker-compose down` l√† l·ªánh an to√†n nh·∫•t ƒë·ªÉ d·ª´ng h·ªá th·ªëng!**